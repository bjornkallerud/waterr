<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>waterr</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">waterr</h1>



<p>In this vignette we document the use cases for the various functions within the <code>waterr</code> package.</p>
<div id="convert_units" class="section level3">
<h3>convert_units</h3>
<p><code>convert_units</code> converts the units of water consumption levels. The first argument is the numeric value or vector that you want to convert. The second and third arguments are the units to convert from and to, respectively.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># convert_units(100, from = &quot;gallons&quot;, to = &quot;hcf&quot;)</span></span></code></pre></div>
</div>
<div id="allocate_consumption" class="section level3">
<h3>allocate_consumption</h3>
<p><code>allocate_consumption</code> distributes water usage across tiers in a tiered rate structure.</p>
</div>
<div id="tierconsumption" class="section level3">
<h3>TierConsumption</h3>
<p>This function allocates water consumption across tiers. <code>nt</code> is the number of tiers in the rate structure, <code>usage</code> is a vector of usage values and <code>width</code> inputs are the widths of the various tiers. You only need to input <code>nt-1</code> widths as the width of the highest tier is infinite. In the case of water budget rates, <code>width</code> parameters can be vectors corresponding to indvidual tier widths.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">TierConsumption</span>(<span class="dt">nt =</span> <span class="dv">2</span>, <span class="dt">usage =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>), <span class="dt">t1width =</span> <span class="dv">10</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt; $t1use</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 10 10 10 10 10 10 10 10 10 10</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; $t2use</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  [1]  0  0  0  0  0  0  0  0  0  0  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
</div>
<div id="waterbill" class="section level3">
<h3>WaterBill</h3>
<p><code>WaterBill</code> calculates water bills for customer usage. In this vignette we demonstrate the function on a sample data set of simulted water usage. This function has two main uses, (a) calculating water bills under the current rate structure and (b) calculating water bills under the current and proposed rate structures. The dataframe used on this function, <code>df</code> needs to have a column titled <code>usage</code> for customer usage.</p>
<div id="uniform-rate-structures" class="section level5">
<h5>Uniform Rate Structures</h5>
<p>When calculating water bills for customers of a water agency, the rates either vary by customer type or they are constant. When calling the function, setting <code>uniform_rates = T</code> will apply a standard rate structure across all customers. In this case, be sure to include the rate structure in the call of the function. <code>fxd_i</code> refers to fixed rates for rate structures <code>i = {c, p}</code> and <code>vol_i</code> is a vector of volumetric rates for rate structures <code>i = {c, p}</code>.</p>
</div>
<div id="current-rate-structure-only" class="section level5">
<h5>Current Rate Structure Only</h5>
<p>If you are interested only in calculating bills under one rate structure you can set <code>proposed_rates = F</code> when calling the function. Under this option, bills will be calculated only for the current rate structure.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># set.seed(8)</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># cust &lt;- data.frame(usage = rbeta(500, 5, 2) * rnorm(500, mean = 10, sd = 5)) %&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#   mutate(usage = ifelse(usage &lt; 0, 0, usage))</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># </span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># df &lt;- WaterBill(cust, uniform_rates = T, nt_c = 3,wdths_c = c(5, 5), fxd_c = 20, vol_c = c(4, 5, 6), </span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#                 proposed_rates = F) </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co"># str(df)</span></span></code></pre></div>
</div>
<div id="current-and-proposed-rates" class="section level5">
<h5>Current and Proposed Rates</h5>
<p>Setting <code>proposed_rates = T</code> will include bill calculations for two bills as well as some comparisons between the bills from the two rate structures. Under this option, the price elasticity of demand is incorporated into bill calculations in the following steps:</p>
<ol style="list-style-type: decimal">
<li>The total bill is calculated under the current rate structure as <code>bill_current</code></li>
<li>The total bill is calculated under the proposed rate structure as <code>bill_proposed</code></li>
<li>Average prices are calculated for both rate structures</li>
<li>The new usage level <code>usage_prime</code> is estimated based on the change in average price</li>
<li>The total bill under the proposed rate structure is calculated with the <code>usage_prime</code></li>
<li>The difference between bills between Step 1 and Step 5 is calculated.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># # Current Rate Structure</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># ntiers_current &lt;- 3</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># tierwidths_current &lt;- c(5, 6)</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># fixedcharge_current &lt;- 25</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># volumetriccharges_current &lt;- c(4, 5, 6)</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co"># </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># # Proposed Rate Structure</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># ntiers_proposed &lt;- 4</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># tierwidths_proposed &lt;- c(2, 3, 4)</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># fixedcharge_proposed &lt;- 30</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co"># volumetriccharges_proposed &lt;- c(2, 3, 6, 7)</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co"># </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co"># # Elasticity parameter</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co"># el &lt;- -0.1</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co"># </span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co"># df &lt;- WaterBill(df = cust, uniform_rates = TRUE, nt_c = ntiers_current, wdths_c = tierwidths_current, </span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#                 fxd_c = fixedcharge_current, vol_c = volumetriccharges_current,</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#                 proposed_rates = TRUE, nt_p = ntiers_proposed, wdths_p = tierwidths_proposed, </span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#                 fxd_p = fixedcharge_proposed,  vol_p = volumetriccharges_proposed) </span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co"># </span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co"># str(df)</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
